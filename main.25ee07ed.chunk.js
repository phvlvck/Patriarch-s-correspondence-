(this.webpackJsonprelp=this.webpackJsonprelp||[]).push([[3],{102:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(0),r=n.n(a),c=n(141);function o(){return r.a.createElement("div",{className:"h-screen col-span-3 lg:col-span-2 flex items-center justify-center"},r.a.createElement(c.a,{color:"#00b2d2"}))}},103:function(e,t,n){"use strict";var a=new(n(48).a)("slug");a.version(1).stores({slug:"id"}),t.a=a},136:function(e,t,n){"use strict";var a=new(n(48).a)("user_database");a.version(1).stores({channel:"id"}),t.a=a},140:function(e,t,n){"use strict";(function(e){var a=n(10),r=n.n(a),c=n(20),o=n(8),s=n(11),i=n(81),l=n.n(i),u=n(136),d=n(103),f=function(){function t(){Object(o.a)(this,t),this.peer=l.a.createECDH("secp256k1"),this.SharedSecret="",this.secrets=new Map}return Object(s.a)(t,[{key:"generateKeys",value:function(){return this.peer.generateKeys(),{Publickey:this.peer.getPublicKey().toString("base64"),PrivateKey:this.peer.getPrivateKey().toString("base64")}}},{key:"generateSharedSecret",value:function(e){this.generateKeys();var t=this.peer.computeSecret(e,"base64","hex");return this.SharedSecret=t,this.peer.getPublicKey().toString("base64")}},{key:"produceSharedSecret",value:function(e){var t=this.peer.computeSecret(e,"base64","hex");return this.SharedSecret=t,this.peer.getPublicKey().toString("base64")}},{key:"setChannel",value:function(e,t,n){var a=this;u.a.channel.add({SharedSecret:this.SharedSecret,id:e}).then(Object(c.a)(r.a.mark((function c(){var o;return r.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(console.log("Success in insertation",a.SharedSecret,e),!t){r.next=6;break}return r.next=4,d.a.slug.where("id").equalsIgnoreCase(n).delete();case 4:o=r.sent,console.log("Deleted ".concat(o," objects"));case 6:case"end":return r.stop()}}),c)})))).catch((function(e){return console.log(e)}))}},{key:"setPrivateKey",value:function(e,t,n){var a=this;return new Promise((function(r,c){try{d.a.slug.where("id").equalsIgnoreCase(e).toArray().then((function(c){var o=c[0].PrivateKey;if(o){a.peer.setPrivateKey(o,"base64");var s=a.peer.computeSecret(n,"base64","hex");a.SharedSecret=s,a.setChannel(t,!0,e),r("Success")}}))}catch(o){console.log(o),c(o)}}))}},{key:"getSharedSecret",value:function(e){var t=this;return new Promise((function(n,a){try{u.a.channel.where("id").equalsIgnoreCase(e).toArray().then((function(a){var r=a[0].SharedSecret;t.secrets.set(e,r),n(r)}))}catch(r){a(r)}}))}},{key:"encrypt",value:function(){var t=Object(c.a)(r.a.mark((function t(n,a){var c,o,s,i,u,d;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.secrets.has(n)){t.next=4;break}c=this.secrets.get(n),t.next=7;break;case 4:return t.next=6,this.getSharedSecret(n);case 6:c=t.sent;case 7:return o=l.a.randomBytes(16),s=l.a.createCipheriv("aes-256-gcm",e.from(c,"hex"),o),i=s.update(JSON.stringify(a),"utf8","hex"),i+=s.final("hex"),u=s.getAuthTag().toString("hex"),d=e.from(o.toString("hex")+i+u,"hex").toString("base64"),t.abrupt("return",d);case 14:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"decrypt",value:function(){var t=Object(c.a)(r.a.mark((function t(n,a){var c,o,s,i,u,d,f;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.secrets.has(n)){t.next=4;break}c=this.secrets.get(n),t.next=7;break;case 4:return t.next=6,this.getSharedSecret(n);case 6:c=t.sent;case 7:return o=e.from(a,"base64").toString("hex"),s=o.substr(0,32),i=o.substr(32,o.length-32-32),u=o.substr(o.length-32,32),(d=l.a.createDecipheriv("aes-256-gcm",e.from(c,"hex"),e.from(s,"hex"))).setAuthTag(e.from(u,"hex")),f=d.update(i,"hex","utf8"),f+=d.final("utf8"),t.abrupt("return",f);case 16:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}();t.a=f}).call(this,n(7).Buffer)},142:function(e,t,n){"use strict";n.d(t,"e",(function(){return E})),n.d(t,"c",(function(){return O})),n.d(t,"a",(function(){return _})),n.d(t,"d",(function(){return S})),n.d(t,"b",(function(){return w}));var a=n(101),r=n(10),c=n.n(r),o=n(2),s=n(37),i=n(20),l=n(449),u=n(22),d=n(65),f=n(4),h=n(140),p=new(n(48).a)("messages");p.version(1).stores({message:"++id , messageId, message, channel, time"});var m=p,g=new h.a,b=document.querySelector("#message-tone"),v=null;"Notification"in window&&(v=Notification.permission);var y=u.a.firestore(),E=function(e,t){return function(){var n=Object(i.a)(c.a.mark((function n(a,r){var i,u,d,h,p,b,v,y,E,O,_,S,w,j,N;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=r().authReducer.user,u=i.uid,d=i.displayName,h=i.photoURL,p=r().channelReducer.channels.filter((function(e){return e.channelId===t.channel})),b=Object(s.a)(p,1),v=b[0],y=r().messageReducer.lastMessage,E={},O=y.has(t.channel),_=y.get(t.channel),O&&"undefined"!==typeof _.message&&!Object(l.a)(_.message.time)&&(E={showDateInfo:!0}),O&&"undefined"===typeof _.message&&(E={showDateInfo:!0}),S=Object(o.a)({from:u},e),w=Object(o.a)(Object(o.a)(Object(o.a)({},S),t),E),j={channel:t.channel,fetch:!0,messages:w},a({type:"ON_MESSAGE",payload:j}),n.prev=12,n.next=15,m.message.add(w);case 15:return n.next=17,g.encrypt(t.channel,S);case 17:N=n.sent,f.a.emit("send message",Object(o.a)(Object(o.a)(Object(o.a)({},t),{},{displayName:d,photoURL:h},E),{},{to:v.from===u?v.to:v.from,body:N})),a({type:"SET_LAST_MESSAGE",payload:{message:w,channel:t.channel}}),n.next=25;break;case 22:n.prev=22,n.t0=n.catch(12),console.log(n.t0);case 25:case"end":return n.stop()}}),n,null,[[12,22]])})));return function(e,t){return n.apply(this,arguments)}}()},O=function(e){return function(){var t=Object(i.a)(c.a.mark((function t(n,a){var r,o,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=a().messageReducer.data).has(e)||!1!==r.get(e).needFetch){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,m.message.where("channel").equals(e).count();case 6:return o=t.sent,t.next=9,m.message.where("channel").equals(e).offset(o-20).toArray();case 9:s=t.sent,n({type:"ON_MESSAGE",payload:{channel:e,messages:s,next:o-20,needFetch:!1}}),n({type:"SET_LAST_MESSAGE",payload:{message:s[s.length-1],channel:e}}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(3),console.log(t.t0);case 17:case"end":return t.stop()}}),t,null,[[3,14]])})));return function(e,n){return t.apply(this,arguments)}}()},_=function(e){return function(){var t=Object(i.a)(c.a.mark((function t(n,a){var r,o,s,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((r=a().messageReducer.data).has(e)){t.next=3;break}return t.abrupt("return");case 3:if(o=r.get(e),!((s=o.next)<=0)){t.next=6;break}return t.abrupt("return");case 6:return t.prev=6,t.next=9,m.message.where("channel").equals(e).offset(s-20).toArray();case 9:i=t.sent,n({type:"SET_MESSAGE_PAGINATION",payload:{channel:e,messages:i,next:s-20,needFetch:!1,fromDb:!0}}),n({type:"SET_LAST_MESSAGE",payload:{message:i[i.length-1],channel:e}}),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(6),console.log(t.t0);case 17:case"end":return t.stop()}}),t,null,[[6,14]])})));return function(e,n){return t.apply(this,arguments)}}()},S=function(e){return function(t,n){var a=n().authReducer.user.uid,r=n().channelReducer.channels.filter((function(t){return t.channelId===e.channel})),c=Object(s.a)(r,1)[0],i=Object(o.a)(Object(o.a)({},e),{},{to:c.from===a?c.to:c.from,from:a});f.a.emit("Typing Indicator",i),t({type:"TYPING_INDICATOR",payload:i})}},w=function(){return function(e){f.a.on("recieve message",function(){var t=Object(i.a)(c.a.mark((function t(n){var a,r,s,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,g.decrypt(n.channel,n.body);case 3:return a=t.sent,r=JSON.parse(a),s=Object(o.a)(Object(o.a)({channel:n.channel,to:n.to},r),{},{showDateInfo:n.showDateInfo}),t.next=8,m.message.add(s);case 8:if(i=window.location.href,e({type:"SET_LAST_MESSAGE",payload:{message:s,channel:n.channel}}),!i.includes(n.channel)){if(b.play(),"granted"===v)try{navigator.serviceWorker.ready.then((function(e){var t="".concat(n.displayName),a={body:r.message,icon:n.photoURL,vibrate:[500,110,500,110,450,110,200,110,170,40,450,110,200,110,170,40,500],actions:[{action:"open_url",title:"Read Message"}],click_action:"https://relp.now.sh/r/".concat(n.channel),tag:r.channel,renotify:!0,requireInteraction:!0};e.showNotification(t,a)}))}catch(c){console.log(c)}e({type:"ON_MESSAGE",payload:{messages:s,channel:n.channel,needFetch:!0,fromDb:!1,outsideRoom:!0}}),e({type:"SET_MESSAGE_COUNT",payload:{channel:n.channel}})}i.includes(n.channel)&&(e({type:"ON_MESSAGE",payload:{messages:s,channel:n.channel,needFetch:!1,fromDb:!1,outsideRoom:!1}}),document.hasFocus()||(e({type:"SET_MESSAGE_COUNT",payload:{channel:n.channel}}),b.play())),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(0),console.log(t.t0);case 17:case"end":return t.stop()}}),t,null,[[0,14]])})));return function(e){return t.apply(this,arguments)}}()),f.a.on("new message",(function(t){t.forEach(function(){var t=Object(i.a)(c.a.mark((function t(n){var a,r,s,i;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(n),t.prev=1,t.next=4,g.decrypt(n.channel,n.body);case 4:return a=t.sent,r=JSON.parse(a),s=window.location.href,i=Object(o.a)(Object(o.a)(Object(o.a)({},n),r),{},{body:""}),e({type:"SET_LAST_MESSAGE",payload:{message:i,channel:n.channel}}),s.includes(n.channel)?e({type:"MESSAGE_FROM_DISK",payload:{channel:n.channel,messages:i,fromMongoDb:!0}}):e({type:"SET_MESSAGE_COUNT",payload:{channel:n.channel}}),t.next=12,m.message.add(i);case 12:f.a.emit("message recieved",n),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(1),console.log(t.t0);case 18:case"end":return t.stop()}}),t,null,[[1,15]])})));return function(e){return t.apply(this,arguments)}}())})),f.a.on("user status disk",(function(t){e({type:"USER_STATUS_DISK",payload:t[0]})})),f.a.on("user status",(function(t){e({type:"USER_STATUS_DISK",payload:t})})),f.a.on("Typing Indicator",(function(t){e({type:"RECIEVED_TYPING_INDICATION",payload:t})})),f.a.on("call by",(function(t){var n=t.from,a=t.to;e({type:"YOU_HAVE_CALL",payload:{from:n,to:a}})})),f.a.on("join call",(function(){e({type:"_CALL_CONNECTED_"})})),f.a.on("dismiss call",(function(){e({type:"DISMISS_CALL"})})),f.a.on("current channel",(function(t){e({type:"INDICATE_CHANNEL",payload:t})})),f.a.on("created channel",(function(){console.log("Refreshing fom the server"),e({type:"REFRESH"}),window.location.pathname.includes("/invite")&&d.a.push("/")})),f.a.on("qrcode connected",function(){var e=Object(i.a)(c.a.mark((function e(t){var n,r,s,i,l;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.to,r=t.from,s=Object(a.a)(t,["to","from"]),i=g.generateKeys(),l=i.Publickey,f.a.emit("send public key",Object(o.a)({to:n,from:r,Publickey:l},s));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),f.a.on("recieve public key",function(){var e=Object(i.a)(c.a.mark((function e(t){var n,r,s,i,l,u,d,h,p;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.from,r=t.to,s=t.fromuID,i=t.touID,l=t.Publickey,u=Object(a.a)(t,["from","to","fromuID","touID","Publickey"]),d=g.generateSharedSecret(l),h={from:s,to:i,time:Date.now(),both:[s,i],generated:!0,joinedBy:"qrcode"},e.prev=3,e.next=6,y.collection("channel").add(h);case 6:p=e.sent,g.setChannel(p.id),f.a.emit("send other public key",Object(o.a)({to:r,from:n,publickey:d,channelId:p.id},u)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),console.lor(e.t0);case 14:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}()),f.a.on("now refresh",(function(){e({type:"REFRESH"}),d.a.push("/")})),f.a.on("recieve other key",(function(t){var n=t.publickey,r=t.channelId,c=t.to,s=Object(a.a)(t,["publickey","channelId","to"]);g.produceSharedSecret(n),g.setChannel(r),f.a.emit("now refresh",Object(o.a)({to:c},s)),e({type:"REFRESH"}),d.a.push("/")}))}}},144:function(e,t,n){"use strict";var a=new(n(48).a)("setting");a.version(1).stores({uid:"id"}),t.a=a},148:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(0),r=n.n(a),c=n(52),o=n(149);function s(e){var t=e.children,n=Object(a.useRef)();return Object(o.a)(n),r.a.createElement(c.b.button,{whileHover:{scale:1.1},whileTap:{scale:.9},type:"button",id:"generateURl",ref:n,style:{minHeight:"48px",outline:"none",cursor:"pointer",paddingLeft:"30px",paddingRight:"30px"},className:"bg-secondary text-white rounded-full text-center font-sans text-bold my-2 w-full"},r.a.createElement("span",{id:"generateURlspan",style:{lineHeight:"48px",textAlign:"center"}},t))}},22:function(e,t,n){"use strict";var a=n(80),r=n.n(a);n(444),n(258);r.a.initializeApp({apiKey:"AIzaSyC9Cy-mfY_ZQQS6UK9G6dv42GglYT0ftws",authDomain:"abigo-share.firebaseapp.com",databaseURL:"https://abigo-share.firebaseio.com",projectId:"abigo-share",storageBucket:"abigo-share.appspot.com",messagingSenderId:"545112504838",appId:"1:545112504838:web:9b145eef919fd2988ce187",measurementId:"G-F5TTLBY3M2"}),r.a.analytics(),r.a.firestore().enablePersistence().catch(console.error),t.a=r.a},249:function(e,t,n){e.exports=n(443)},283:function(e,t,n){},310:function(e,t){},313:function(e,t,n){},315:function(e,t){},317:function(e,t){},327:function(e,t){},329:function(e,t){},356:function(e,t){},357:function(e,t){},36:function(e,t,n){e.exports={borderBorder:"responsive_borderBorder__19eD5",borderLeft:"responsive_borderLeft__38C5B",overFLow:"responsive_overFLow__1PT09",picturE:"responsive_picturE__3wWNv",grid7:"responsive_grid7__26fs1",grid6:"responsive_grid6__2fxZX",grid1:"responsive_grid1__3vxV-",gray1:"responsive_gray1__2Mc58",tick:"responsive_tick__1vl0M",width:"responsive_width__3Nlis",flexa:"responsive_flexa__2PZd_",conversation:"responsive_conversation__2R8bX",Chat:"responsive_Chat__1PZ0Y",chatBoxHeight:"responsive_chatBoxHeight__2NUjV",ChatBox:"responsive_ChatBox__2yLDg",input:"responsive_input__15Lse",no:"responsive_no__1QFmj",message:"responsive_message__21sQ0",other:"responsive_other__3y2L2",meta:"responsive_meta__13A69",text_wrapper_sanitize:"responsive_text_wrapper_sanitize__3pXk-",hwx:"responsive_hwx__3XASa",img_container_real:"responsive_img_container_real__1SIYj",inside:"responsive_inside__2btNM",blur:"responsive_blur__1K0op",other_img:"responsive_other_img__1FB26",pdf:"responsive_pdf__1Wppv",progress_ring:"responsive_progress_ring__2qLbk",download:"responsive_download__1_y-o",default:"responsive_default__3ufaK",animate:"responsive_animate__27SbG",messageCount:"responsive_messageCount__23X0F",message_hide:"responsive_message_hide__2kOgb",message_show:"responsive_message_show__3uRw2",bottomButton:"responsive_bottomButton__3hvQC",neomorphism:"responsive_neomorphism__2J2AN",lightNeomorphism:"responsive_lightNeomorphism__3_ocA"}},362:function(e,t){},364:function(e,t){},388:function(e,t){},4:function(e,t,n){"use strict";var a=n(242),r=n.n(a),c="localhost"===window.location.hostname?"http://".concat(window.location.hostname,":8080"):"https://relp-server.up.railway.app/",o=r.a.connect(c);t.a=o},415:function(e,t){},417:function(e,t){},425:function(e,t){},427:function(e,t){},443:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(34),o=n(47),s=n(41),i=n(239),l=n(17),u=n(450),d=n(240),f=n(37),h=n(245),p=n(83),m=n(36),g=n.n(m),b=window.matchMedia("(prefers-color-scheme: dark)").matches,v=function(){return r.a.createElement("div",{className:"flex w-screen h-screen justify-center items-center bg-primary fixed z-50"},r.a.createElement("div",{className:"".concat(b?g.a.neomorphism:g.a.lightNeomorphism," p-16 ")},r.a.createElement("svg",{className:"w-24 h-24",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M461.143 265C594.906 -107.264 71 512 71 512C71 512 146.242 401.414 146.242 265C461.143 55.05 71 18 71 18C71 18 327.379 637.264 461.143 265Z",fill:"#00B2D2"}))))},y=n(98),E=n(102);function O(){return r.a.createElement("div",{className:"flex flex-col justify-center items-center p-4"},r.a.createElement("p",{className:"".concat(g.a.gray1," pt-3")},"Something went wrong"),r.a.createElement("div",{onClick:function(){return window.location.reload()},onKeyUp:function(){return window.location.reload()},role:"button",tabIndex:"0",className:"flex flex-row items-center justify-around mt-3 p-2 px-3 shadow-md bg-secondary rounded-full"},r.a.createElement("svg",{width:"24",height:"24",className:"fill-current ".concat(g.a.gray1),viewBox:"0 0 24 24"},r.a.createElement("g",null,r.a.createElement("path",{d:"M12 2C6.486 2 2 6.486 2 12c0 .414.336.75.75.75s.75-.336.75-.75c0-4.687 3.813-8.5 8.5-8.5s8.5 3.813 8.5 8.5-3.813 8.5-8.5 8.5c-2.886 0-5.576-1.5-7.13-3.888l2.983.55c.402.08.798-.193.874-.6.076-.408-.194-.8-.6-.874l-4.663-.86c-.204-.04-.414.01-.58.132-.168.123-.276.31-.3.515l-.57 4.706c-.05.412.242.785.653.835.03.004.06.006.09.006.375 0 .698-.278.745-.66l.32-2.63C5.673 20.36 8.728 22 12 22c5.514 0 10-4.486 10-10S17.514 2 12 2z"}))),r.a.createElement("div",{className:"ml-1"},"Try again")))}var _=n(42),S=n(52),w=n(148);function j(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("nav",{className:"flex text-white  flex-row justify-around py-1 lg:w-64 lg:flex-col lg:p-3"},r.a.createElement(_.b,{to:"/",className:"hidden lg:block"},r.a.createElement("div",{className:"text-white  text-lg pt-2  flex items-center justify-center rounded-full hover:bg-secondary",style:{width:"50px",height:"50px",padding:"1px"},title:"Safeshare Logo"},r.a.createElement("svg",{style:{width:"37px",height:"37px"},viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M21.6161 12.4219C27.8862 -5.02801 3.32812 24 3.32812 24C3.32812 24 6.85509 18.8163 6.85509 12.4219C21.6161 2.58047 3.32812 0.84375 3.32812 0.84375C3.32812 0.84375 15.3459 29.8718 21.6161 12.4219Z",fill:"#F4F4F9"})))),r.a.createElement(_.b,{exact:!0,to:"/",className:"py-1 rounded-full navlink ",activeClassName:"activated"},r.a.createElement(S.b.div,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"".concat(g.a.width," flex py-2 px-3 items-center")},r.a.createElement("div",{className:"pr-3 text-2xl "},r.a.createElement("svg",{viewBox:"0 0 24 24",className:"w-6 fill-current "},r.a.createElement("g",null,r.a.createElement("path",{d:"M22.58 7.35L12.475 1.897c-.297-.16-.654-.16-.95 0L1.425 7.35c-.486.264-.667.87-.405 1.356.18.335.525.525.88.525.16 0 .324-.038.475-.12l.734-.396 1.59 11.25c.216 1.214 1.31 2.062 2.66 2.062h9.282c1.35 0 2.444-.848 2.662-2.088l1.588-11.225.737.398c.485.263 1.092.082 1.354-.404.263-.486.08-1.093-.404-1.355zM12 15.435c-1.795 0-3.25-1.455-3.25-3.25s1.455-3.25 3.25-3.25 3.25 1.455 3.25 3.25-1.455 3.25-3.25 3.25z"})))),r.a.createElement("div",{className:"text-xl font-bold hidden lg:block"}," Home "))),r.a.createElement(_.b,{to:"/settings",activeClassName:"activated",className:"py-1 rounded-full navlink"},r.a.createElement(S.b.div,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"".concat(g.a.width," flex py-2 px-3 items-center")},r.a.createElement("div",{className:"pr-3 text-2xl"},r.a.createElement("svg",{viewBox:"0 0 24 24",className:"w-6 fill-current"},r.a.createElement("g",null,r.a.createElement("path",{d:"M12 8.21c-2.09 0-3.79 1.7-3.79 3.79s1.7 3.79 3.79 3.79 3.79-1.7 3.79-3.79-1.7-3.79-3.79-3.79zm0 6.08c-1.262 0-2.29-1.026-2.29-2.29S10.74 9.71 12 9.71s2.29 1.026 2.29 2.29-1.028 2.29-2.29 2.29z"}),r.a.createElement("path",{d:"M12.36 22.375h-.722c-1.183 0-2.154-.888-2.262-2.064l-.014-.147c-.025-.287-.207-.533-.472-.644-.286-.12-.582-.065-.798.115l-.116.097c-.868.725-2.253.663-3.06-.14l-.51-.51c-.836-.84-.896-2.154-.14-3.06l.098-.118c.186-.222.23-.523.122-.787-.11-.272-.358-.454-.646-.48l-.15-.014c-1.18-.107-2.067-1.08-2.067-2.262v-.722c0-1.183.888-2.154 2.064-2.262l.156-.014c.285-.025.53-.207.642-.473.11-.27.065-.573-.12-.795l-.094-.116c-.757-.908-.698-2.223.137-3.06l.512-.512c.804-.804 2.188-.865 3.06-.14l.116.098c.218.184.528.23.79.122.27-.112.452-.358.477-.643l.014-.153c.107-1.18 1.08-2.066 2.262-2.066h.722c1.183 0 2.154.888 2.262 2.064l.014.156c.025.285.206.53.472.64.277.117.58.062.794-.117l.12-.102c.867-.723 2.254-.662 3.06.14l.51.512c.836.838.896 2.153.14 3.06l-.1.118c-.188.22-.234.522-.123.788.112.27.36.45.646.478l.152.014c1.18.107 2.067 1.08 2.067 2.262v.723c0 1.183-.888 2.154-2.064 2.262l-.155.014c-.284.024-.53.205-.64.47-.113.272-.067.574.117.795l.1.12c.756.905.696 2.22-.14 3.06l-.51.51c-.807.804-2.19.864-3.06.14l-.115-.096c-.217-.183-.53-.23-.79-.122-.273.114-.455.36-.48.646l-.014.15c-.107 1.173-1.08 2.06-2.262 2.06zm-3.773-4.42c.3 0 .593.06.87.175.79.328 1.324 1.054 1.4 1.896l.014.147c.037.4.367.7.77.7h.722c.4 0 .73-.3.768-.7l.014-.148c.076-.842.61-1.567 1.392-1.892.793-.33 1.696-.182 2.333.35l.113.094c.178.148.366.18.493.18.206 0 .4-.08.546-.227l.51-.51c.284-.284.305-.73.048-1.038l-.1-.12c-.542-.65-.677-1.54-.352-2.323.326-.79 1.052-1.32 1.894-1.397l.155-.014c.397-.037.7-.367.7-.77v-.722c0-.4-.303-.73-.702-.768l-.152-.014c-.846-.078-1.57-.61-1.895-1.393-.326-.788-.19-1.678.353-2.327l.1-.118c.257-.31.236-.756-.048-1.04l-.51-.51c-.146-.147-.34-.227-.546-.227-.127 0-.315.032-.492.18l-.12.1c-.634.528-1.55.67-2.322.354-.788-.327-1.32-1.052-1.397-1.896l-.014-.155c-.035-.397-.365-.7-.767-.7h-.723c-.4 0-.73.303-.768.702l-.014.152c-.076.843-.608 1.568-1.39 1.893-.787.326-1.693.183-2.33-.35l-.118-.096c-.18-.15-.368-.18-.495-.18-.206 0-.4.08-.546.226l-.512.51c-.282.284-.303.73-.046 1.038l.1.118c.54.653.677 1.544.352 2.325-.327.788-1.052 1.32-1.895 1.397l-.156.014c-.397.037-.7.367-.7.77v.722c0 .4.303.73.702.768l.15.014c.848.078 1.573.612 1.897 1.396.325.786.19 1.675-.353 2.325l-.096.115c-.26.31-.238.756.046 1.04l.51.51c.146.147.34.227.546.227.127 0 .315-.03.492-.18l.116-.096c.406-.336.923-.524 1.453-.524z"})))),r.a.createElement("div",{className:"text-xl font-bold hidden lg:block"},"Settings"))),r.a.createElement(_.b,{to:"/about",activeClassName:"activated",className:"py-1 rounded-full navlink "},r.a.createElement(S.b.div,{whileHover:{scale:1.1},whileTap:{scale:.9},className:"".concat(g.a.width," flex py-2 px-3 items-center")},r.a.createElement("div",{className:"pr-3 text-2xl "},r.a.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",className:"w-6 fill-current ",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M11 10.9794C11 10.4271 11.4477 9.97937 12 9.97937C12.5523 9.97937 13 10.4271 13 10.9794V16.9794C13 17.5317 12.5523 17.9794 12 17.9794C11.4477 17.9794 11 17.5317 11 16.9794V10.9794Z",fill:"currentColor"}),r.a.createElement("path",{d:"M12 6.05115C11.4477 6.05115 11 6.49886 11 7.05115C11 7.60343 11.4477 8.05115 12 8.05115C12.5523 8.05115 13 7.60343 13 7.05115C13 6.49886 12.5523 6.05115 12 6.05115Z",fill:"currentColor"}),r.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12Z",fill:"currentColor"}))),r.a.createElement("div",{className:"text-xl font-bold hidden lg:block"}," About "))),r.a.createElement(_.b,{to:"/create",className:"hidden lg:block lg:mt-2"},r.a.createElement(w.a,null,"Invite Friends"))))}n(283);function N(){return r.a.createElement("header",{className:"col-span-1 z-40 fixed bottom-0 lg:sticky lg:top-0"},r.a.createElement("div",{style:{border:"0px",borderRight:"1px solid rgb(56, 68, 77)"},className:"bg-primary lg:sticky lg:h-screen lg:top-0  lg:m-auto flex flex-wrap justify-center"},r.a.createElement("div",{className:" w-screen lg:w-auto h-full"},r.a.createElement(j,null))))}var C=Object(s.b)((function(e){return{aerror:e.authReducer.error,ferror:e.firestoreReducer.error,smessage:e.firestoreReducer.message,nuser:e.authReducer.isnewUser,noti:e.authReducer.notified}}),(function(e){return{sent:function(){return e(Object(p.f)())}}}))((function(e){var t=e.aerror,n=e.ferror,r=e.smessage,c=e.nuser,o=e.noti,s=e.sent,i=Object(y.useToasts)().addToast;return Object(a.useEffect)((function(){if(t&&i(t.message,{appearance:"error",autoDismiss:!0,autoDismissTimeout:6e3}),n&&i(n.message,{appearance:"error",autoDismiss:!0,autoDismissTimeout:6e3}),r&&i(r.message,{appearance:"success",autoDismiss:!0,autoDismissTimeout:6e3}),c&&!o){i("Welcome to Relp. Invite your friend to get started",{appearance:"success",autoDismiss:!0,autoDismissTimeout:6e3}),s()}}),[n,t,r,c,i,o,s]),null})),x=n(4),R=(n(313),n(142)),I=n(67),T=new(n(97).a);var A=Object(s.b)(null,(function(e){return{setCallStatus:function(t){return e(Object(I.h)(t))},jCall:function(){return e(Object(I.j)())}}}))((function(e){var t=e.callStatus,n=e.setCallStatus,c=e.jCall,o=Object(a.useState)("incoming call..."),s=Object(f.a)(o,2),i=s[0],l=s[1];Object(a.useEffect)((function(){var e=function(){l("Connected")};return T.on("connected",e),function(){return T.off("connected",e)}}),[i]);var u=function(){T.connected&&T.peer.destroy(),n(null)};return r.a.createElement("div",{style:{zIndex:999999,transform:"translate(-50%, -50%)",left:"50%",top:"50%"},className:"fixed p-8 bg-gray-700 shadow-2xl rounded-lg flex flex-col items-center justify-center"},r.a.createElement("div",null,r.a.createElement("img",{src:t.from.photoURL,width:"80",height:"80",alt:"Profile",className:"rounded-full"})),r.a.createElement("div",{style:{textAlign:"center"},className:"flex flex-col mt-1"},r.a.createElement("span",{className:"text-base font-bold"},t.from.displayName),r.a.createElement("span",{className:"text-light text-sm"},i)),r.a.createElement("div",{className:"flex flex-row mt-1 p-1"},r.a.createElement("div",{className:"bg-red-600 rounded-full p-3",onClick:u,role:"button",tabIndex:"0",onKeyDown:u},r.a.createElement("svg",{className:"text-white ","aria-hidden":"false",width:"24",height:"24",viewBox:"0 0 24 24"},r.a.createElement("path",{fill:"currentColor",d:"M18.4 4L12 10.4L5.6 4L4 5.6L10.4 12L4 18.4L5.6 20L12 13.6L18.4 20L20 18.4L13.6 12L20 5.6L18.4 4Z"}))),"incoming call..."===i&&r.a.createElement("div",{className:"bg-green-600 rounded-full p-3 ml-3",onClick:function(){T.connected||(c(),l("Connecting..."),T.Call(t.to,t.from.from))},role:"button",tabIndex:"0",onKeyDown:function(){return console.log()}},r.a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24",viewBox:"0 0 24 24",className:"text-white fill-current",width:"24"},r.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),r.a.createElement("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"})))))})),L=Object(a.lazy)((function(){return n.e(16).then(n.bind(null,491))})),D=Object(a.lazy)((function(){return Promise.all([n.e(0),n.e(2),n.e(9)]).then(n.bind(null,504))})),k=Object(a.lazy)((function(){return n.e(12).then(n.bind(null,503))})),G=Object(a.lazy)((function(){return n.e(8).then(n.bind(null,492))})),U=Object(a.lazy)((function(){return n.e(18).then(n.bind(null,493))})),M=Object(a.lazy)((function(){return Promise.all([n.e(7),n.e(15)]).then(n.bind(null,500))})),F=Object(a.lazy)((function(){return Promise.all([n.e(0),n.e(10)]).then(n.bind(null,502))})),P=Object(a.lazy)((function(){return n.e(19).then(n.bind(null,494))})),H=Object(a.lazy)((function(){return n.e(14).then(n.bind(null,495))})),B=Object(a.lazy)((function(){return Promise.all([n.e(2),n.e(6),n.e(13)]).then(n.bind(null,499))})),z=Object(a.lazy)((function(){return n.e(11).then(n.bind(null,496))}));var W=Object(s.b)((function(e){return{loginState:e.authReducer,callStatus:e.peerReducer.callStatus,nuser:e.authReducer.isnewUser}}),(function(e){return{init:function(){return e(Object(p.h)())},recieveMessage:function(){return e(Object(R.b)())},iChannel:function(t,n,a){return e(Object(I.b)(t,n,a))}}}))((function(e){var t=e.loginState,n=e.init,c=e.reciveFiles,o=e.recieveMessage,s=e.iChannel,i=e.callStatus,u=e.nuser,d=Object(a.useState)(),p=Object(f.a)(d,2),m=p[0],g=p[1],b=Object(a.useState)(!1),_=Object(f.a)(b,2),S=_[0],w=_[1];Object(a.useEffect)((function(){n()}),[n]),Object(a.useEffect)((function(){o()}),[o]),Object(a.useLayoutEffect)((function(){"serviceWorker"in navigator&&(navigator.serviceWorker.onmessage=function(e){e.data.url&&g(e.data.url)})}),[m]),Object(a.useEffect)((function(){var e,n=(null===(e=t.user)||void 0===e?void 0:e.uid)||null;t.authenticated&&s(!1,n,!0)}),[t,s]),Object(a.useEffect)((function(){var e,n,a={uid:(null===(e=t.user)||void 0===e?void 0:e.uid)||null,displayName:(null===(n=t.user)||void 0===n?void 0:n.displayName)||"Anonymous",online:!0};t.authenticated&&x.a.emit("authenticated",a);var r=function(){"visible"===document.visibilityState&&t.authenticated&&x.a.emit("authenticated",a)};document.addEventListener("visibilitychange",r),window.addEventListener("online",r)}),[t,c]),Object(a.useEffect)((function(){u&&w(!0)}),[S,u]);var j=window.location,R=j.pathname,I=j.search,T=R.split("/")[2];return r.a.createElement(h.ErrorBoundary,{FallbackComponent:O},t.isLoginLoading&&r.a.createElement(v,null),!t.isLoginLoading&&!t.authenticated&&R.includes("/join")&&r.a.createElement(l.a,{to:"/login?url=".concat(R)}),!t.isLoginLoading&&!t.authenticated&&!R.includes("/invite")&&!R.includes("/join")&&!I.includes("/join")&&r.a.createElement(l.a,{to:"/login"}),!t.isLoginLoading&&t.authenticated&&R.includes("/invite")&&r.a.createElement(l.a,{to:"/channel/"+T}),m&&!t.isLoginLoading&&t.authenticated&&r.a.createElement(l.a,{to:m}),r.a.createElement(a.Suspense,{fallback:r.a.createElement(E.a,null)},r.a.createElement(l.d,null,r.a.createElement(l.b,{path:"/login",component:L}),r.a.createElement(l.b,{path:"/invite/:id",component:G}))),r.a.createElement(y.ToastProvider,null,r.a.createElement(C,null)),S&&r.a.createElement("fn-pwa-banner",{background:"#187a8c",title:"Install relp"}),r.a.createElement("fn-pwa-status",{background:"#187a8c"}),i&&r.a.createElement(A,{callStatus:i}),t.authenticated&&r.a.createElement("div",{className:"lg:grid lg:grid-cols-4 "},r.a.createElement(N,null),r.a.createElement(a.Suspense,{fallback:r.a.createElement(E.a,null)},r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/",component:D}),r.a.createElement(l.b,{path:"/r/:id",component:B}),r.a.createElement(l.b,{path:"/settings",component:M}),r.a.createElement(l.b,{path:"/about",component:k}),r.a.createElement(l.b,{path:"/create",component:F}),r.a.createElement(l.b,{path:"/join/:from",component:U}),r.a.createElement(l.b,{path:"/logout",component:P}),r.a.createElement(l.b,{path:"/channel/:id",component:H}),r.a.createElement(l.b,{component:z})))))})),K=n(65),J=n(2),q={authenticated:!1,isGuest:!1,isnewUser:!1,isLoading:!1,isLoginLoading:!0,notified:!1,error:null,waiting:!1,user:null,updated_error:null},Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN_SUCCESS":return Object(J.a)(Object(J.a)({},e),{},{authenticated:!0,user:t.user,waiting:!1,isLoading:!1});case"LOGIN_SUCCESS_STATE":return Object(J.a)(Object(J.a)({},e),{},{authenticated:!0,user:t.user,waiting:!1,isLoginLoading:!1});case"LOGIN_WAITING":return Object(J.a)(Object(J.a)({},e),{},{authenticated:!1,waiting:!0,user:t.user,isLoading:!0});case"LOGIN_ERROR":return Object(J.a)(Object(J.a)({},e),{},{error:t.error,authenticated:!1,isLoginLoading:!1});case"LOGIN_SUCCESS_GUEST":return Object(J.a)(Object(J.a)({},e),{},{isGuest:!0,authenticated:!0,isLoginLoading:!1});case"ADDED_USER":return Object(J.a)(Object(J.a)({},e),{},{isnewUser:!0,isLoading:!0,waiting:!0,user:t.user});case"NOT_LOGIN":return Object(J.a)(Object(J.a)({},e),{},{authenticated:!1,user:t.user,isLoginLoading:!1});case"SEND_NOTIFICATION":return Object(J.a)(Object(J.a)({},e),{},{notified:!0});case"LOGOUT":return Object(J.a)(Object(J.a)({},e),{},{authenticated:!1,user:null,isLoading:!1});case"LOGOUT_ERROR":return Object(J.a)(Object(J.a)({},e),{},{error:t.error});case"UPDATE_FAILED":return Object(J.a)(Object(J.a)({},e),{},{updated_error:t.err});default:return e}},V={generated:!1,pending:!0,error:!1,waiting:!1,slug:"Generating...",invite:!1,message:!1},Z=n(49),Q={loading:!0,channels:[],empty:!1,fetch:!1,visited:[]},X={connected:!1,shareID:null,current:null,err:null,progress:100,type:null,isCall:!1,callStatus:null,qrCodeData:{}},$=n(138);Object($.a)();var ee=new Map,te={data:ee,userStatus:ee,currentChannel:ee,localCache:ee,messageCount:ee,lastMessage:ee},ne=function(e,t){if(e.localCache.has(t)){var n=e.localCache.get(t);e.data.get(t).messages.push(n.messages),e.localCache.delete(t)}},ae=Object($.b)((function(e,t){var n=t.type,a=t.payload;switch(n){case"ON_MESSAGE":var r=e.data.has(a.channel),c=e.data.get(a.channel);return r&&a.needFetch&&a.fromDb?(e.data.set(a.channel,{channel:a.channel,needFetch:a.needFetch,messages:a.messages,next:a.next,indication:"NO_CONTENT"}),e):a.outsideRoom?c.needFetch?(c.needFetch=a.needFetch,e):(e.data.set(a.channel,{needFetch:a.needFetch}),e):(a.fromMongoDb&&!c.messages&&e.data.set(a.channel,{needFetch:!0}),r&&!c.messages&&Array.isArray(a.messages)?(e.data.set(a.channel,{channel:a.channel,needFetch:a.needFetch,messages:a.messages,next:a.next,indication:"NO_CONTENT"}),ne(e,a.channel),e):r?(e.data.get(a.channel).messages.push(a.messages),e):(e.data.set(a.channel,{channel:a.channel,needFetch:a.needFetch,messages:a.messages,next:a.next,indication:"NO_CONTENT"}),ne(e,a.channel),e));case"MESSAGE_FROM_DISK":var o=e.data.has(a.channel),s=e.data.get(a.channel);return o&&Array.isArray(s.messages)?s.messages.push(a.messages):e.localCache.set(a.channel,{messages:a.messages}),e;case"SET_MESSAGE_COUNT":var i=e.messageCount.has(a.channel),l=e.messageCount.get(a.channel);return i?l.messageCount+=1:e.messageCount.set(a.channel,{messageCount:1}),document.title="(1) Relp",e;case"CLEAR_MESSAGE_COUNT":return e.messageCount.has(a.channel)&&e.messageCount.delete(a.channel),"clearAppBadges"in navigator&&navigator.clearAppBadge().catch((function(e){console.log(e)})),e;case"SET_LAST_MESSAGE":return e.lastMessage.set(a.channel,{message:a.message}),e;case"SET_MESSAGE_PAGINATION":var u=e.data.get(a.channel);return u.messages=a.messages,u.next=a.next,e;case"SET_URL":var d=e.data.get(a.payload.channel).messages;return d[d.length-1].url=a.url,e;case"USER_STATUS_DISK":return a&&a.uid?(e.userStatus.set(a.uid,{status:a}),e):e;case"TYPING_INDICATION":return e.data.has(a.channelId)?e.data.get(a.channelId).indication=a.type:e.set(a.channelId,{indication:a.type}),e;case"TYPING_INDICATOR":return e.data.has(a.channel)?e.data.get(a.channel).self=a.type:e.data.set(a.channel,{self:a.type}),e;case"RECIEVED_TYPING_INDICATION":return e.data.has(a.channel)?e.data.get(a.channel).other=a.type:e.data.set(a.channel,{other:a.type}),e;case"INDICATE_CHANNEL":if(e.currentChannel.size<=1)if(e.currentChannel.has(a.channelID))e.currentChannel.get(a.channelID).IDs.push(a.uid);else e.currentChannel.set(a.channelID,{IDs:[a.uid]});return e;default:return e}}),te),re=Object(o.combineReducers)({authReducer:Y,firestoreReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"WRITE_SUCCESS":return Object(J.a)(Object(J.a)({},e),{},{generated:!0,pending:!1,slug:a.slug});case"WRITE_ERROR":return Object(J.a)(Object(J.a)({},e),{},{error:{message:"Cannot Fetch the slug"},message:a.error});case"UPDATE_SLUG":return Object(J.a)(Object(J.a)({},e),{},{generated:!1,pending:!0,slug:a.slug});case"FETCH_SUCCESS":return Object(J.a)(Object(J.a)({},e),{},{invite:a.doc});case"FETCH_SUCCESS_WAITING":return Object(J.a)(Object(J.a)({},e),{},{invite:a.doc,waiting:!0});case"FETCH_ERROR":return Object(J.a)(Object(J.a)({},e),{},{invite:!1,createdRoom:!1,error:a.err});case"FETCH_WAITING":return Object(J.a)(Object(J.a)({},e),{},{waiting:!0});case"CREATED_CHANNEL":return Object(J.a)(Object(J.a)({},e),{},{createdRoom:a.slug,message:{message:"Created channel successfully."},waiting:!1});case"CHANNEL_ERROR":return Object(J.a)(Object(J.a)({},e),{},{createdRoom:!1,error:a});case"GENERAL_ERROR":return Object(J.a)(Object(J.a)({},e),{},{error:a});case"GENERAL_SUCCESS":return Object(J.a)(Object(J.a)({},e),{},{message:a});default:return e}},channelReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"FETCH_SUCCESS":return Object(J.a)(Object(J.a)({},e),{},{loading:!1,fetch:!0,empty:!1,channels:[].concat(Object(Z.a)(e.channels),[a.pro])});case"FETCH_ERROR":return Object(J.a)(Object(J.a)({},e),{},{empty:!1,loading:!1});case"FETCH_EMPTY":return Object(J.a)(Object(J.a)({},e),{},{channels:[],loading:!1,fetch:!0,empty:!0});case"FETCH_WAITING":return Object(J.a)(Object(J.a)({},e),{},{loading:!0});case"REFRESH":return Object(J.a)(Object(J.a)({},e),{},{channels:[],loading:!0,fetch:!1});case"SUCCESS_IN_UPDATE":return Object(J.a)(Object(J.a)({},e),{},{visited:[].concat(Object(Z.a)(e.visited),[a.slug])});default:return e}},peerReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.payload;switch(n){case"PEER_CONNECTED":return Object(J.a)(Object(J.a)({},e),{},{connected:a});case"SET_SHAREID":return Object(J.a)(Object(J.a)({},e),{},{shareID:a});case"CURRENT_CHANNEL":return Object(J.a)(Object(J.a)({},e),{},{current:a.res});case"PROGRESS":return Object(J.a)(Object(J.a)({},e),{},{shareID:a.shareID,progress:a.sentBytes});case"SHOW_PLACEHOLDER":return Object(J.a)(Object(J.a)({},e),{},{type:a.type});case"SET_VOICE_CALL":return Object(J.a)(Object(J.a)({},e),{},{isCall:a});case"YOU_HAVE_CALL":return Object(J.a)(Object(J.a)({},e),{},{callStatus:a});case"DISMISS_CALL":return Object(J.a)(Object(J.a)({},e),{},{callStatus:null,isCall:!1});case"ERROR_WHILE_SENDING":return Object(J.a)(Object(J.a)({},e),{},{err:a});case"QRCODE":return Object(J.a)(Object(J.a)({},e),{},{qrCodeData:Object(J.a)({},a)});default:return e}},messageReducer:ae}),ce=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function oe(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(n.postMessage({type:"UPDATE",payload:!0}),console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}n(441),n(442);u.a({dsn:"https://b4f289a04be74ee48871e66af6cbc0ff@o400302.ingest.sentry.io/5258603"});var se=Object(o.createStore)(re,Object(d.composeWithDevTools)(Object(o.applyMiddleware)(i.a))),ie=document.getElementById("root");Object(c.render)(r.a.createElement(s.a,{store:se},r.a.createElement(l.c,{history:K.a},r.a.createElement(W,null))),ie),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/pwabuilder-sw.js");ce?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):oe(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):oe(t,e)}))}}()},65:function(e,t,n){"use strict";var a=n(27);t.a=Object(a.a)()},67:function(e,t,n){"use strict";n.d(t,"d",(function(){return j})),n.d(t,"c",(function(){return N})),n.d(t,"g",(function(){return C})),n.d(t,"f",(function(){return x})),n.d(t,"e",(function(){return R})),n.d(t,"b",(function(){return I})),n.d(t,"i",(function(){return T})),n.d(t,"a",(function(){return A})),n.d(t,"h",(function(){return L})),n.d(t,"j",(function(){return D}));var a=n(37),r=n(82),c=n(8),o=n(11),s=n(23),i=n(24),l=n(79),u=n.n(l),d=n(26),f=n(137),h=n(144),p=n(243),m=n(244),g=n.n(m),b=n(4),v=new g.a,y=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this)).state={answer:null,offer:null,peer:null,connected:!1,shareID:null,autoDownload:!1},a.uid=e,a.params=window.location.pathname.split("/")[2],h.a.uid.where("id").equalsIgnoreCase(a.uid).toArray().then((function(e){e&&(a.state.autoDownload=e[0].autoDownload)})).catch((function(e){return console.log})),a.peer=new u.a({initiator:"#init"===window.location.hash,trickle:!1}),a.peer.on("signal",(function(e){"offer"===e.type&&(a.state.offer=e,a.emit("got offer"))})),a.on("got meta data",(function(e){var t=e.payload;v.receive(a.peer,t.messages.shareID).then((function(e){if(a.emit("transfer started",t),e.on("progress",(function(e){a.emit("receive progress",{sentBytes:e,shareID:t.messages.shareID})})),e.on("done",(function(e){var n=URL.createObjectURL(e);a.emit("recieved",{url:n,payload:t})})),a.state.autoDownload){var n=e.createReadStream();f.WritableStream=p.a;var r=f.createWriteStream(t.messages.name,{size:t.messages.size}).getWriter();n.on("data",(function(e){return r.write(e)})).on("end",(function(){return r.close()}))}}))})),a.peer.on("data",(function(e){try{var t=JSON.parse(e);"text/relp"===(null===t||void 0===t?void 0:t.type)&&a.emit("got meta data",t)}catch(n){console.log(n)}})),a}return Object(o.a)(n,[{key:"Signal",value:function(e,t){var n=this;this.emit("instance",this.peer),this.on("got offer",(function(){console.log("Sending data first attempt"),b.a.emit("offer",{from:e,to:t,payload:JSON.stringify(n.state.offer)})})),this.peer.on("connect",(function(){console.log("Finally Connected \ud83d\ude00\ud83c\udf89\ud83c\udf8a\ud83e\udd73"),n.print(),n.state.connected=!0})),b.a.on("backAnswer",(function(e){n.state.answer=JSON.parse(e.payload),n.peer.signal(n.state.answer)}))}},{key:"Init",value:function(){var e=this;return b.a.on("backOffer",(function(t){e.state.offer=JSON.parse(t.payload),e.emit("instance",e.peer),console.log(e.state.offer),e.peer.on("signal",(function(n){e.state.answer=n,b.a.emit("answer",{from:t.from,to:t.to,payload:JSON.stringify(n)})})),e.peer.signal(e.state.offer),e.peer.on("connect",(function(){return console.log("Finally Connected \ud83d\ude00\ud83c\udf89\ud83c\udf8a\ud83e\udd73"),e.print(),e.state.connected=!0,e.emit("connected",e.state.connected)}))})),this.on("newConnection",(function(){e.emit("connected",!1)})),this.emit("connected",!1)}},{key:"Send",value:function(e,t,n){var a=this;e?this.peer.send(JSON.stringify(e)):v.send(this.peer,n,t).then((function(e){e.on("progress",(function(e){a.emit("send progress",e)})),e.start()}))}},{key:"print",value:function(){console.table({offer:this.state.offer,answer:this.state.answer})}}]),n}(d.EventEmitter),E=n(97),O=n(22),_=(n(439),O.a.database()),S=null,w=function(e,t){var n=t().authReducer.user.uid,r=t().channelReducer.channels.filter((function(t){return t.channelId===e})),c=Object(a.a)(r,1)[0];return{finalTo:c.from===n?c.to:c.from,uid:n}},j=function(e,t){return function(n){S=new y(e),console.log("Im the initiator. Happy"),S.Signal(e,t),S.peer.on("connect",(function(){console.log("Connected"),n({type:"PEER_CONNECTED",payload:!0})}))}},N=function(){return function(e,t){var n=t().authReducer.user.uid;(S=new y(n)).Init(),S.on("connected",(function(){e({type:"PEER_CONNECTED",payload:!0})}))}},C=function(e,t,n){return function(a,r){var c=w(t,r).finalTo;c&&b.a.emit("shareID",{shareID:e,finalTo:c,channelID:t,type:n.type,name:n.name})}},x=function(e,t,n,a){return function(c,o){var s=w(a,o),i=s.finalTo,l=s.uid;if(null!==S){var u=Object(r.a)(25),d={messages:{type:e.type,name:e.name,time:Date.now(),url:t,shareID:n,from:l,messageId:u,to:i},channel:a};c({type:"ON_MESSAGE",payload:d}),S.Send({type:"text/relp",payload:{channel:d.channel,messages:{url:"placeholder",type:e.type,name:e.name,size:e.size,time:Date.now(),shareID:n,from:l,messageId:u,to:i}}}),S.Send(!1,e,n),c({type:"PROGRESS",payload:{sentBytes:0,shareID:n}}),S.on("send progress",(function(e){c({type:"PROGRESS",payload:{sentBytes:e,shareID:n}})}))}else c({type:"ERROR_WHILE_SENDING",payload:"NOT_CONNECTED"})}},R=function(){return function(e){S&&(S.on("transfer started",(function(t){e({type:"ON_MESSAGE",payload:t})})),S.on("receive progress",(function(t){e({type:"PROGRESS",payload:t})})),S.on("recieved",(function(t){var n=t.url,a=t.payload;e({type:"SET_URL",payload:{url:n,payload:a}}),e({type:"PROGRESS",payload:{sentBytes:100,shareID:a.shareID}})})))}},I=function(e,t,n){return function(){n?_.ref(t).set(null):_.ref(t).set(e)}},T=function(e){return function(t){_.ref(e).on("value",(function(e){t({type:"CURRENT_CHANNEL",payload:{res:e.val()}})}))}},A=function(e,t){return function(n,a){var r=w(t,a),c=r.finalTo,o=r.uid,s=a().authReducer.user,i=s.displayName,l=s.photoURL;(new E.a).Init(),b.a.emit("call by",{from:{from:o,displayName:i,photoURL:l},to:c}),n({type:"SET_VOICE_CALL",payload:e})}},L=function(e){return function(e,t){var n=t().authReducer.user.uid,a=t().peerReducer.callStatus.from;b.a.emit("dismiss call",{to:a,from:n}),e({type:"DISMISS_CALL"})}},D=function(){return function(e,t){var n=t().authReducer.user.uid,a=t().peerReducer.callStatus.from;b.a.emit("join call",{to:a,from:n}),e({type:"WAITING_FOR_RTC"})}}},83:function(e,t,n){"use strict";n.d(t,"c",(function(){return d})),n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return h})),n.d(t,"d",(function(){return p})),n.d(t,"h",(function(){return m})),n.d(t,"e",(function(){return b})),n.d(t,"f",(function(){return g})),n.d(t,"g",(function(){return v}));var a=n(10),r=n.n(a),c=n(20),o=n(82),s=n(22),i=(n(261),s.a.firestore()),l=function(e,t,n,a){i.collection("users").doc(e.uid).get().then((function(r){r.exists?(n({type:"LOGIN_SUCCESS",user:e}),console.log("User Exists...")):(n({type:"ADDED_USER",user:e}),i.collection("users").doc(e.uid).set(t).then((function(){console.log("Added the user"),a?s.a.auth().currentUser.updateProfile({displayName:t.displayName,photoURL:t.photoURL}).then((function(){n({type:"LOGIN_SUCCESS_GUEST",user:e})})).catch((function(e){console.error(e),n({type:"LOGIN_ERROR",err:e})})):n({type:"LOGIN_SUCCESS",user:e})})).catch((function(e){n({type:"LOGIN_ERROR",err:e})})))})).catch((function(e){return console.log(e)}))},u=function(e,t){s.a.auth().signInWithPopup(e).then((function(e){var n=e.credential.accessToken,a=e.user;console.log(a,n);var r={displayName:a.displayName,email:a.email,token:n,isAnonymous:a.isAnonymous,photoURL:a.photoURL,uid:a.uid,joinedAt:s.a.firestore.FieldValue.serverTimestamp()};t({type:"LOGIN_WAITING",user:a}),l(a,r,t,!1)})).catch((function(e){t({type:"LOGIN_ERROR",error:e}),console.log(e)}))},d=function(){return function(e){var t=new s.a.auth.GoogleAuthProvider;u(t,e)}},f=function(){return function(e){var t=new s.a.auth.GithubAuthProvider;u(t,e)}},h=function(){return function(e){var t=new s.a.auth.FacebookAuthProvider;u(t,e)}},p=function(){return function(e){s.a.auth().signInAnonymously().then((function(t){e({type:"LOGIN_WAITING"});var n=t.user,a="G-".concat(Object(o.a)(5)),r=0===Math.floor(2*Math.random())?"https://firebasestorage.googleapis.com/v0/b/abigo-share.appspot.com/o/1cbd08c76f8af6dddce02c5138971129.png?alt=media&token=6d549fa7-4e5a-457b-9f0e-09773b3bd634":"https://firebasestorage.googleapis.com/v0/b/abigo-share.appspot.com/o/322c936a8c8be1b803cd94861bdfa868.png?alt=media&token=81205467-68f1-4140-8796-e302adee78c8",c={uid:n.uid,displayName:a,isAnonymous:n.isAnonymous,photoURL:r,joinedAt:s.a.firestore.FieldValue.serverTimestamp()};l(n,c,e,!0)})).catch((function(t){e({type:"LOGIN_ERROR",error:t})}))}},m=function(){return function(e,t){s.a.auth().onAuthStateChanged((function(n){n?(console.log("%c STATE_CHANGED:"," color: #00b2d2",n),t().authReducer.waiting||e({type:"LOGIN_SUCCESS_STATE",user:n})):e({type:"NOT_LOGIN",user:n})}))}},g=function(){return function(e){e({type:"SEND_NOTIFICATION"})}},b=function(){return function(e){s.a.auth().signOut().then((function(){e({type:"LOGOUT"})})).catch((function(t){e({type:"LOGOUT_ERROR",error:t})}))}},v=function(e,t){return function(){var n=Object(c.a)(r.a.mark((function n(a){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(t),n.prev=1,n.next=4,i.collection("users").doc(t.uid).get();case 4:if(!n.sent.exists){n.next=10;break}return n.next=8,i.collection("users").doc(t.uid).update(e);case 8:return n.next=10,s.a.auth().currentUser.updateProfile({displayName:e.displayName,photoURL:e.photoURL});case 10:a({type:"UPDATE_SUCCESS"}),n.next=17;break;case 13:n.prev=13,n.t0=n.catch(1),console.log(n.t0),a({type:"UPDATE_FAILED",err:n.t0});case 17:case"end":return n.stop()}}),n,null,[[1,13]])})));return function(e){return n.apply(this,arguments)}}()}},97:function(e,t,n){"use strict";var a=n(8),r=n(11),c=n(23),o=n(24),s=n(79),i=n.n(s),l=n(26),u=n(4),d=function(e){Object(c.a)(n,e);var t=Object(o.a)(n);function n(){var e;return Object(a.a)(this,n),(e=t.call(this)).state={offer:{},gotAnswer:!1,answer:{}},e.connected=!1,e.peer="",e}return Object(r.a)(n,[{key:"Call",value:function(e,t){var n=this;navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(a){n.stream=a,n.peer=new i.a({initiator:!0,trickle:!1,stream:a}),n.peer.on("signal",(function(a){console.log("peer1",a),"offer"===a.type&&(n.state.offer=a),console.log("Sending offer..."),u.a.emit("callOffer",{from:e,to:t,payload:JSON.stringify(a)})})),n.peer.on("connect",(function(){console.log("Finally Connected \ud83d\ude00\ud83c\udf89\ud83c\udf8a\ud83e\udd73"),n.connected=!0,n.emit("connected"),n.print()})),u.a.on("callBackAnswer",(function(e){console.log(JSON.parse(e.payload)),n.state.answer=JSON.parse(e.payload),n.peer.signal(n.state.answer)})),n.peer.on("stream",(function(e){var t=new Audio;t.srcObject=e,t.play(),console.log("Got s",e)})),n.peer.on("data",(function(e){console.log(JSON.parse(e))})),n.peer.on("destroy",(function(){n.connected=!1})),n.peer.on("error",(function(e){n.connected=!1,console.log(e)}))})).catch((function(){return alert("No webcam access!")}))}},{key:"Init",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.stream=t,console.log("Init signal"),e.peer=new i.a({trickle:!1,stream:t}),u.a.on("callBackOffer",(function(t){e.state.offer=JSON.parse(t.payload),console.log("peer2",e.state.offer),e.peer.on("signal",(function(n){e.state.answer=n,u.a.emit("callAnswer",{from:t.from,to:t.to,payload:JSON.stringify(n)})})),e.peer.signal(e.state.offer),e.peer.on("connect",(function(){console.log("Finally Connected \ud83d\ude00\ud83c\udf89\ud83c\udf8a\ud83e\udd73"),e.emit("connected"),e.connected=!0,e.print()}))})),e.peer.on("stream",(function(e){var t=new Audio;t.srcObject=e,t.play(),console.log(e)})),e.peer.on("destroy",(function(){e.connected=!1})),e.peer.on("error",(function(t){e.connected=!1,console.log(t)}))})).catch((function(){return alert("No webcam access!")}))}},{key:"print",value:function(){console.table({offer:this.state.offer,answer:this.state.answer})}}]),n}(l.EventEmitter);t.a=d}},[[249,4,5]]]);
//# sourceMappingURL=main.25ee07ed.chunk.js.map